# -- Provide a name in place of `"omni"`.
nameOverride: ""

# -- String to fully override `"omni.fullname"`.
fullnameOverride: ""

# -- String to fully override `"omni.namespace"`.
namespaceOverride: ""

# -- Number of replicas to run.
# Omni currently only supports a single replica.
# If embedded etcd is used, this value should remain at 1.
# If an external etcd cluster is used, multiple replicas can be used, but they will run an etcd election and only one instance will be active at a time, others will be standby.
replicaCount: 1

# Deployment strategy. Omni currently only supports Recreate strategy.
strategy:
  # -- Deployment strategy type.
  type: Recreate

# Omni image configuration.
image:
  # -- Repository to use for Omni.
  repository: ghcr.io/siderolabs/omni
  # -- Image pull policy for Omni.
  pullPolicy: IfNotPresent
  # -- Tag to use for Omni.
  tag: ""

# -- Set to true to bypass the SemVer check (e.g. if using a custom build or nightly tag).
skipVersionCheck: false

# -- Secrets with credentials to pull images from a private registry.
imagePullSecrets: []

# -- Extra arguments to pass to Omni.
# Note: --config-path is automatically generated by the chart based on the base config and additionalConfigSources.
args: []
  #- --debug

# -- Additional config sources to merge on top of the base config.
# These are merged in order: base config (from config: section) -> additionalConfigSources (in order) -> flags.
# This is useful for bringing in secrets from external sources (e.g., External Secrets Operator).
# Each source must contain a valid Omni config YAML that will be merged with the base config.
additionalConfigSources: []
  # Example: Load OIDC credentials from an existing secret
  #- existingSecret: oidc-credentials
  #  key: config.yaml  # optional, defaults to config.yaml
  # Example: Load additional settings from a ConfigMap
  #- existingConfigMap: extra-settings
  #  key: settings.yaml

# Omni Configuration.
# For full configuration reference, see the schema at:
# https://github.com/siderolabs/omni/blob/main/internal/pkg/config/schema.json
config:
  # Account contains account-related configuration.
  account:
    # -- Unique identifier and name for this Omni instance.
    # Must be a UUID and not changed during the lifetime of the installation.
    #id: ""
    # -- Name is the human-readable name of the account.
    name: app
    # UserPilot contains UserPilot-related configuration.
    #userPilot:
      # AppToken is the UserPilot application token.
      #appToken: ""
  # Auth contains authentication-related configuration.
  auth:
    # Auth0 contains Auth0 authentication provider configuration.
    auth0:
      # -- Enabled controls whether the Auth0 authentication provider is enabled.
      enabled: true
      # -- ClientID is the Auth0 client ID.
      clientID: ""
      # -- Domain is the Auth0 domain.
      domain: ""
      # UseFormData controls whether the Auth0 provider should use form data for authentication requests.
      #useFormData: false
    # -- InitialServiceAccount contains configuration for the initial service account created when Omni is run for the first time.
    initialServiceAccount:
      # Enabled controls whether the initial service account is created.
      #enabled: false
      # Role is the role assigned to the initial service account.
      #role: Admin
      # KeyPath is the path where the initial service account key is stored.
      #keyPath: _out/initial-service-account-key
      # Name is the name of the initial service account.
      #name: automation
      # Lifetime is the lifetime of the initial service account key.
      #lifetime: 1h
    # -- InitialUsers is a list of emails which should be created as admins when Omni is run for the first time.
    initialUsers: []
      #- initial-user-1@example.com
      #- initial-user-2@example.com
    # -- KeyPruner contains configuration for the public keys pruner.
    keyPruner:
      # Interval is the interval at which the key pruner runs.
      #interval: 10m
    # Suspended is whether the Omni account is suspended.
    #suspended: false
    # -- OIDC contains OIDC authentication provider configuration.
    oidc:
      # Enabled controls whether the OIDC authentication provider is enabled.
      #enabled: false
      # ProviderURL is the OIDC provider URL.
      #providerURL: ""
      # ClientID is the OIDC client ID.
      #clientID: ""
      # ClientSecret is the OIDC client secret.
      # Tip: Use additionalConfigSources to load this from an existing Secret.
      #clientSecret: ""
      # LogoutURL is the OIDC logout URL.
      #logoutURL: ""
      # Scopes is the list of OIDC scopes to request during authentication.
      #scopes: []
      # AllowUnverifiedEmail controls whether users with unverified emails are allowed to authenticate.
      #allowUnverifiedEmail: false
    # -- SAML contains SAML authentication provider configuration.
    saml:
      # Enabled controls whether the SAML authentication provider is enabled.
      #enabled: false
      # URL is the SAML provider URL. Mutually exclusive with metadata.
      #url: ""
      # Metadata is the SAML provider metadata URL. Mutually exclusive with url.
      #metadata: ""
      # NameIDFormat is the SAML NameID format to be used.
      #nameIDFormat: ""
      # LabelRules defines mapping of SAML assertion attributes into Omni identity labels.
      #labelRules: {}
      # AttributeRules defines additional identity, fullname, firstname and lastname mappings.
      #attributeRules: {}
  # Debug contains debug-related configuration.
  debug:
    # -- Server contains debug server configuration.
    server:
      # Endpoint is the network endpoint the debug server listens on.
      #endpoint: ":9988"
    # -- Pprof contains pprof profiling configuration.
    pprof:
      # Endpoint is the network endpoint the pprof server listens on.
      #endpoint: ""
  # EtcdBackup contains etcd backup configuration for the clusters on Omni.
  etcdBackup:
    # -- LocalPath is the local path where etcd backups are stored.
    # Path-based backups are enabled when this is set.
    # This path is mounted from the persistent volume by default.
    localPath: /data/etcd-backup
    # -- S3Enabled controls whether an S3-compatible storage is used for etcd backups.
    # Mutually exclusive with localPath.
    s3Enabled: false
    # TickInterval is the interval between etcd backups ticks.
    #tickInterval: 1m
    # MinInterval is the minimum interval between two etcd backups for a cluster.
    #minInterval: 1h
    # MaxInterval is the maximum interval between two etcd backups for a cluster.
    #maxInterval: 24h
    # Jitter is the jitter for etcd backups.
    #jitter: 10m
    # UploadLimitMbps is the optional upload bandwidth limit in megabits per second.
    #uploadLimitMbps: 0
    # DownloadLimitMbps is the optional download bandwidth limit in megabits per second.
    #downloadLimitMbps: 0
  # -- Features contains feature flags to enable/disable various Omni features.
  features:
    # EnableTalosPreReleaseVersions controls whether pre-release Talos versions are available.
    #enableTalosPreReleaseVersions: false
    # EnableBreakGlassConfigs controls whether break-glass machine configurations are enabled.
    #enableBreakGlassConfigs: false
    # EnableConfigDataCompression controls whether machine configuration data is compressed.
    #enableConfigDataCompression: true
    # EnableClusterImport controls whether the cluster import feature is enabled.
    #enableClusterImport: true
    # DisableControllerRuntimeCache controls whether the controller-runtime cache is disabled.
    #disableControllerRuntimeCache: false
  # Logs contains logging-related configuration.
  logs:
    # -- Audit contains audit logs configuration.
    audit:
      # Enabled controls whether audit logging is enabled.
      #enabled: true
      # SqliteTimeout is the timeout for SQLite operations used for audit logs storage.
      #sqliteTimeout: 30s
    # Machine contains machine logs configuration.
    machine:
      # -- Storage contains configuration for machine logs storage.
      storage:
        # SqliteTimeout is the timeout for SQLite operations used for machine logs storage.
        #sqliteTimeout: 30s
        # CleanupInterval is the interval at which old machine logs are cleaned up.
        #cleanupInterval: 30m
        # CleanupOlderThan is the duration after which machine logs are eligible for cleanup.
        #cleanupOlderThan: 720h
        # MaxLinesPerMachine is the maximum number of log lines to keep per machine.
        #maxLinesPerMachine: 5000
        # CleanupProbability is the probability of triggering the cleanup on each log write.
        #cleanupProbability: 0.01
    # -- ResourceLogger contains resource logger configuration.
    resourceLogger:
      # LogLevel is the logging level used by the resource logger.
      #logLevel: info
      # Types is the list of resource types to be logged by the resource logger.
      # The user-managed resource types are:
      #types:
      #  - identities
      #  - users
      #  - accesspolicies
      #  - samllabelrules
      #  - jointokens
      #  - defaultjointokens
      #  - grpctunnelconfigs
      #  - clusters
      #  - configpatches
      #  - etcdmanualbackups
      #  - machineclasses
      #  - machinelabels
      #  - machinesets
      #  - machinesetnodes
      #  - etcdbackups3configs
      #  - extensionsconfigurations
      #  - kernelargs
      #  - machinerequestsets
      #  - importedclustersecrets
      #  - inframachinebmcconfigs
      #  - inframachineconfigs
      #  - installationmediaconfigs
      #  - nodeforcedestroyrequests
      #  - infraproviders
  # -- Registries contains container image registries configuration.
  registries:
    # Talos is the Talos installer registry configuration.
    #talos: ghcr.io/siderolabs/installer
    # Kubernetes is the Kubernetes container registry configuration.
    #kubernetes: ghcr.io/siderolabs/kubelet
    # ImageFactoryBaseURL is the base URL of the Image Factory service.
    #imageFactoryBaseURL: https://factory.talos.dev
    # ImageFactoryPXEBaseURL is the base URL of the Image Factory PXE endpoint.
    #imageFactoryPXEBaseURL: ""
    # Mirrors is the list of container image registry mirrors.
    #mirrors: []
  # Services contains configuration for various services run by Omni.
  services:
    # Api contains API/UI service configuration.
    api:
      # -- The advertised URL for the main Omni GRPC and HTTP API and Web UI.
      # MUST be specified as a full URL, including scheme (http:// or https://).
      # It MUST match the URL of the main ingress if ingress is used.
      advertisedURL: https://omni.example.com
      # Endpoint is the network endpoint the service listens on. It is in the form "host:port".
      #endpoint: "0.0.0.0:8080"
      # CertFile is the path to the TLS certificate file for the service.
      #certFile: ""
      # KeyFile is the path to the TLS key file for the service.
      #keyFile: ""
    # DevServerProxy is the node dev server proxy service configuration. It exists for the development purposes only.
    #devServerProxy:
      # Endpoint is the network endpoint the dev server proxy service listens on. It is in the form "host:port".
      #endpoint: ""
      # AdvertisedURL is the URL that the dev server proxy service advertises to clients. It is in the form "http(s)://host:port". When not set, it is generated by the system based on the endpoint and TLS cert/key configuration.
      #advertisedURL: ""
      # CertFile is the path to the TLS certificate file for the dev server proxy service.
      #certFile: ""
      # KeyFile is the path to the TLS key file for the dev server proxy service.
      #keyFile: ""
      # ProxyTo is the address to which the dev server proxy service forwards incoming requests. It is in the form "http(s)://host:port".
      #proxyTo: ""
    # Metrics contains metrics service configuration.
    #metrics:
      # Endpoint is the network endpoint the service listens on. It is in the form "host:port".
      #endpoint: "0.0.0.0:2122"
      # AdvertisedURL is the URL that the service advertises to clients. It is in the form "http(s)://host:port". When not set, it is generated by the system based on the endpoint and TLS cert/key configuration.
      #advertisedURL: ""
      # CertFile is the path to the TLS certificate file for the service.
      #certFile: ""
      # KeyFile is the path to the TLS key file for the service.
      #keyFile: ""
    # KubernetesProxy contains Kubernetes proxy service configuration.
    kubernetesProxy:
      # -- The advertised URL for the Kubernetes API Proxy.
      # MUST be specified as a full URL, including scheme (https://).
      # It MUST match the URL of the kubernetes proxy ingress if ingress is used.
      advertisedURL: https://kubernetes.omni.example.com
      # Endpoint is the network endpoint the Kubernetes proxy service listens on. It is in the form "host:port".
      #endpoint: "0.0.0.0:8095"
      # CertFile is the path to the TLS certificate file for the Kubernetes proxy service.
      #certFile: ""
      # KeyFile is the path to the TLS key file for the Kubernetes proxy service.
      #keyFile: ""
    # MachineAPI contains SideroLink API service configuration.
    machineAPI:
      # -- The advertised URL for the SideroLink (Machine) API.
      # MUST be specified as a full URL, including scheme (http:// or https://).
      # It MUST match the URL of the siderolink API ingress if ingress is used.
      advertisedURL: https://siderolink.omni.example.com
      # Endpoint is the network endpoint the service listens on. It is in the form "host:port".
      #endpoint: ""
      # CertFile is the path to the TLS certificate file for the service.
      #certFile: ""
      # KeyFile is the path to the TLS key file for the service.
      #keyFile: ""
    # Siderolink contains SideroLink service configuration.
    siderolink:
      # -- JoinTokensMode configures how machine join tokens are generated and used.
      joinTokensMode: strict
      # DisableLastEndpoint controls whether the SideroLink service should stop using the last known endpoint.
      #disableLastEndpoint: false
      # UseGRPCTunnel controls whether the SideroLink service should tunnel WireGuard traffic over gRPC.
      #useGRPCTunnel: false
      # -- EventSinkPort is the port to be used by the nodes to publish their events over SideroLink to Omni.
      eventSinkPort: 8091
      # LogServerPort is the port to be used by the nodes to send their logs over SideroLink to Omni.
      #logServerPort: 8092
      # WireGuard contains WireGuard-specific configuration for the SideroLink service.
      wireGuard:
        # -- The advertised address for WireGuard connections.
        # MUST be specified in IP:PORT format (hostname is NOT supported, must be an IP address).
        # In most setups, this is either:
        # - NodePort: Use the externally accessible IP of a node and service.wireguard.nodePort (e.g., "203.0.113.10:30180")
        # - LoadBalancer: Use the LoadBalancer's external IP and service.wireguard.port (e.g., "203.0.113.50:50180")
        #advertisedEndpoint: ""
        # Endpoint is the network endpoint the WireGuard interface listens on. It is in the form "ip:port" (IP address is required, not hostname).
        #endpoint: "0.0.0.0:50180"
    # -- LoadBalancer contains load balancer service configuration.
    loadBalancer:
      # MinPort is the minimum port number for load balancer allocation.
      #minPort: 10000
      # MaxPort is the maximum port number for load balancer allocation.
      #maxPort: 35000
      # DialTimeout is the timeout used when dialing backend control plane nodes.
      #dialTimeout: 15s
      # KeepAlivePeriod is the period used for keep-alive pings to backend nodes.
      #keepAlivePeriod: 30s
      # TcpUserTimeout is the TCP user timeout value set on connections.
      #tcpUserTimeout: 30s
      # HealthCheckInterval is the interval between health checks on backend nodes.
      #healthCheckInterval: 20s
      # HealthCheckTimeout is the timeout for health checks on backend nodes.
      #healthCheckTimeout: 15s
    # -- LocalResourceService contains local resource service configuration.
    localResourceService:
      # Enabled controls whether the local resource service is enabled.
      #enabled: true
      # Port is the network port the local resource service listens on.
      #port: 8081
    # -- EmbeddedDiscoveryService contains embedded discovery service configuration.
    embeddedDiscoveryService:
      # Enabled controls whether the embedded discovery service is enabled.
      #enabled: true
      # Port is the network port the embedded discovery service listens on.
      #port: 8093
      # SnapshotsEnabled controls whether the embedded discovery service periodically persists snapshots.
      #snapshotsEnabled: true
      # SnapshotsInterval is the interval at which the embedded discovery service persists snapshots.
      #snapshotsInterval: 10m
      # LogLevel is the logging level used by the embedded discovery service.
      #logLevel: warn
      # SqliteTimeout is the timeout for SQLite operations.
      #sqliteTimeout: 30s
    # WorkloadProxy contains workload proxy service configuration.
    workloadProxy:
      # -- Enabled controls whether the workload proxy service is enabled.
      # In on-prem setups, it is often disabled.
      enabled: false
      # -- Subdomain is the subdomain used by the workload proxy service to expose workloads.
      subdomain: omni-workload
      # StopLBsAfter is the duration after which load balancers are stopped for idle workloads.
      #stopLBsAfter: 5m
  # Storage contains persistent storage related configuration.
  storage:
    # Default contains the default storage backend configuration.
    default:
      # -- Kind is the kind of the default storage backend (etcd or boltdb).
      kind: etcd
      # Boltdb contains BoltDB storage backend configuration.
      boltdb:
        # -- Path to the primary BoltDB database.
        # Is **NOT USED by default**: only used if the storage.default.kind is set to "boltdb".
        # This path is mounted from the persistent volume by default.
        path: /data/omni-boltdb.db
      # Etcd contains etcd storage backend configuration.
      etcd:
        # -- Embedded controls whether to use embedded etcd server as the storage backend.
        embedded: true
        # -- EmbeddedDBPath is the path where the embedded etcd database files are stored.
        # This path is mounted from the persistent volume by default.
        embeddedDBPath: /data/etcd/
        # -- PrivateKeySource is the source of the private key for decrypting master key slot.
        privateKeySource: file:///omni.asc
        # RunElections controls whether the embedded etcd server should run leader elections.
        #runElections: false
        # Endpoints is the list of etcd endpoints. Only used when external etcd is used (i.e., embedded is false).
        #endpoints: []
        # DialKeepAliveTime is the keep-alive time for etcd client connections.
        #dialKeepAliveTime: 30s
        # DialKeepAliveTimeout is the keep-alive timeout for etcd client connections.
        #dialKeepAliveTimeout: 5s
        # CaFile is the path to the CA certificate file for etcd client connections.
        #caFile: etcd/ca.crt
        # CertFile is the path to the TLS certificate file for etcd client connections.
        #certFile: etcd/client.crt
        # KeyFile is the path to the TLS key file for etcd client connections.
        #keyFile: etcd/client.key
        # EmbeddedUnsafeFsync controls whether the embedded etcd server should skip fsync calls for improved performance at the cost of durability.
        #embeddedUnsafeFsync: false
        # PublicKeyFiles is the list of public key files for the embedded etcd server. They are used for encrypting keys slots.
        #publicKeyFiles: []
    # Sqlite contains SQLite storage backend configuration.
    sqlite:
      # -- Path to the SQLite database (secondary storage).
      # This path is mounted from the persistent volume by default.
      path: /data/secondary-storage/sqlite.db
      # ExperimentalBaseParams contains the base parameters to be used when opening the SQLite database connection. This can cause data corruption if set incorrectly, modify at your own risk. This flag is experimental and may be removed in future versions. It must not start with a question mark (?).
      #experimentalBaseParams: "_txlock=immediate&_pragma=busy_timeout(50000)&_pragma=journal_mode(WAL)&_pragma=synchronous(NORMAL)"
      # ExtraParams contains the extra parameters to be used when opening the SQLite database connection. This can cause data corruption if set incorrectly, modify at your own risk. It must not start with an ampersand (&).
      #extraParams: ""
    # Vault contains HashiCorp Vault storage backend configuration.
    vault:
      # -- Url is the URL of the Vault server.
      url: ""
      # -- Token is the authentication token for the Vault server.
      # Tip: Use additionalConfigSources to load this from an existing Secret,
      # or set the VAULT_TOKEN environment variable via env/envFrom.
      token: ""
      # K8sAuthMountPath is the mount path of the Kubernetes auth method in Vault.
      # When not set, it defaults to "kubernetes".
      # This is useful when Vault is running on a different cluster and has multiple Kubernetes auth mounts.
      #k8sAuthMountPath: ""

# -- Environment variables to pass to Omni.
env: []

# -- envFrom to pass to Omni.
envFrom: []
#- configMapRef:
#    name: config-map-name
#- secretRef:
#    name: secret-name

# Etcd Encryption Key Configuration
# This secret contains the GPG private key required to decrypt Omni's master key.
# Without this key, Omni cannot decrypt its database and will fail to start.
#
# To create a new GPG key and export it to a file named omni.asc, you can use the following command:
# (export GNUPGHOME=$(mktemp -d); gpg --batch --passphrase '' --quick-gen-key x; gpg -a --export-secret-key > omni.asc; rm -rf $GNUPGHOME)
etcdEncryptionKey:
  # -- Name of an existing Secret containing the GPG private key.
  existingSecret: ""
  # -- GPG private key content (multiline string).
  omniAsc: ""

# Ingress Configuration
# This section configures standard Kubernetes Ingress resources.
# Use this if you are using an Ingress Controller like NGINX, Traefik, or HAProxy.
ingress:
  # Ingress for the Web UI and gRPC API
  main:
    # -- Enable ingress for Web UI and gRPC API.
    enabled: false
    # -- Set to true to skip validation between this Ingress and config.services.api.advertisedURL
    skipConfigCheck: false
    # -- Additional Annotations.
    # The default annotations ensure compatibility with NGINX Ingress Controller.
    # They are ignored by other ingress controllers.
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: GRPC
      nginx.ingress.kubernetes.io/proxy-body-size: 32m
      nginx.ingress.kubernetes.io/service-upstream: "true"
    # -- Additional Labels
    labels: {}
    # -- Ingress Class Name
    className: ""
    # -- Omni hostname
    host: omni.example.com
    # -- TLS configuration
    tls: []
    #- secretName: omni-tls
    #  hosts:
    #    - omni.example.com
  # Ingress for the Kubernetes Proxy
  kubernetesProxy:
    # -- Enable ingress for Kubernetes Proxy.
    enabled: false
    # -- Set to true to skip validation between this Ingress and config.services.kubernetesProxy.advertisedURL
    skipConfigCheck: false
    # -- Additional Annotations
    annotations: {}
    # -- Additional Labels
    labels: {}
    # -- Ingress Class Name
    className: ""
    # -- Omni Kubernetes Proxy hostname
    host: kubernetes.omni.example.com
    # -- TLS configuration
    tls: []
    #- secretName: omni-k8s-proxy-tls
    #  hosts:
    #    - kubernetes.omni.example.com
  # Ingress for the SideroLink Machine API
  siderolinkApi:
    # -- Enable ingress for SideroLink Machine API.
    enabled: false
    # -- Set to true to skip validation between this Ingress and config.services.machineAPI.advertisedURL
    skipConfigCheck: false
    # -- Additional Annotations.
    # The default annotations ensure compatibility with NGINX Ingress Controller.
    # They are ignored by other ingress controllers.
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: GRPC
      nginx.ingress.kubernetes.io/proxy-body-size: 100m
    # -- Additional Labels
    labels: {}
    # -- Ingress Class Name
    className: ""
    # -- Omni SideroLink Machine API hostname
    host: siderolink.omni.example.com
    # -- TLS configuration
    tls: []
    #- secretName: omni-siderolink-tls
    #  hosts:
    #    - siderolink.omni.example.com

# Gateway API Configuration
# NOTE: Gateway API support is in EXPERIMENTAL status
# Support depends on your Gateway controller implementation
gatewayApi:
  # Route for the Web UI
  ui:
    # -- Enable HTTPRoute for Web UI.
    enabled: false
    # -- Additional Annotations
    annotations: {}
    # -- Additional Labels
    labels: {}
    # -- The Gateway(s) to attach this route to.
    # You MUST define at least one parentRef for the route to be active.
    parentRefs: []
    #- name: my-gateway
    #  namespace: my-gateway-namespace
    #  sectionName: https-listener
    # -- Omni UI hostname
    hostnames:
      - omni.example.com
  # Route for the Kubernetes Proxy
  kubernetesProxy:
    # -- Enable HTTPRoute for Kubernetes Proxy.
    enabled: false
    # -- Additional Annotations
    annotations: {}
    # -- Additional Labels
    labels: {}
    # -- The Gateway(s) to attach this route to.
    # You MUST define at least one parentRef for the route to be active.
    parentRefs: []
    #- name: my-gateway
    #  namespace: my-gateway-namespace
    #  sectionName: https-listener
    # -- Omni Kubernetes Proxy hostname
    hostnames:
      - kubernetes.omni.example.com
  # Route for the SideroLink Machine API
  siderolinkApi:
    # -- Enable GRPCRoute for SideroLink Machine API.
    enabled: false
    # -- Additional Annotations
    annotations: {}
    # -- Additional Labels
    labels: {}
    # -- The Gateway(s) to attach this route to.
    # You MUST define at least one parentRef for the route to be active.
    parentRefs: []
    #- name: my-gateway
    #  namespace: my-gateway-namespace
    #  sectionName: https-listener
    # -- Omni SideroLink Machine API hostname
    hostnames:
      - siderolink.omni.example.com


# Probes Configuration
# -- Liveness probe configuration.
livenessProbe: {}
# -- Readiness probe configuration.
readinessProbe:
  failureThreshold: 3
  httpGet:
    path: /healthz
    port: omni
    scheme: HTTP
  periodSeconds: 5
  successThreshold: 1
  timeoutSeconds: 3


# Persistence Configuration
# This volume stores all critical state: the internal database (etcd/sqlite), encryption keys,
# generated machine configurations, and logs.
# If disabled, all cluster state and identity will be lost upon pod restart.
persistence:
  # -- Enable persistence. Mounts to `/data` inside the container.
  enabled: true
  # -- Annotations
  annotations: {}
  # -- Name of an existing PersistentVolumeClaim to use.
  # If set, a new PVC will NOT be created.
  existingClaim: ""
  # -- Storage Class to use for the PVC.
  # Leave empty to use the cluster's default storage class.
  storageClassName: ""
  # -- Access modes for the PVC.
  # 'ReadWriteOnce' is recommended as Omni does not support multiple active replicas writing to the same file-based DB.
  accessModes:
    - ReadWriteOnce
  # -- Size of the persistent volume.
  # Recommended: 16Gi+ for production to handle etcd snapshots and logs.
  size: 16Gi


# Resources Configuration
# -- CPU and Memory resource requests and limits.
resources: {}
#limits:
#  cpu: 100m
#  memory: 128Mi
#requests:
#  cpu: 100m
#  memory: 128Mi


# -- Pod Security Context
# Omni container-level security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
    add:
      - NET_ADMIN


# Service Configuration
# Configures the Kubernetes Services to expose Omni's network endpoints.
# - 'main': Exposes the HTTP/gRPC API, UI and SideroLink API (ClusterIP by default). Uses h2c (HTTP/2 cleartext).
# - 'k8sProxy': Exposes the Kubernetes API proxy (ClusterIP by default). Separate service because it does not support h2c.
# - 'wireguard': Exposes the UDP wireGuard interface for SideroLink (NodePort/LoadBalancer required for external access).
service:
  main:
    # -- Annotations for the main service.
    # Traefik does not yet support appProtocol (https://github.com/traefik/traefik/issues/11089),
    # so this annotation is needed to tell Traefik to use h2c when communicating with the backend.
    # It is ignored by other ingress controllers.
    annotations:
      traefik.ingress.kubernetes.io/service.serversscheme: h2c
    # -- Additional labels for the main service.
    labels: {}
    # -- Service type for the main service.
    type: ClusterIP
    # -- Port for the Omni HTTP/gRPC API and UI.
    omniPort: 8080
    # -- NodePort for the Omni HTTP/gRPC API (only used when type is NodePort).
    omniNodePort: ""
    # -- Port for the SideroLink API.
    siderolinkApiPort: 8090
    # -- NodePort for the SideroLink API (only used when type is NodePort).
    siderolinkApiNodePort: ""
    # -- ClusterIP for the main service.
    clusterIP: ""
    # -- LoadBalancer IP for the main service (only used when type is LoadBalancer).
    loadBalancerIP: ""
  # Kubernetes proxy service configuration.
  # This is a separate service because the Kubernetes proxy does not support h2c,
  # and the h2c annotation on the main service would break it.
  k8sProxy:
    # -- Annotations for the Kubernetes proxy service.
    annotations: {}
    # -- Additional labels for the Kubernetes proxy service.
    labels: {}
    # -- Service type for the Kubernetes proxy service.
    type: ClusterIP
    # -- Port for the Kubernetes proxy.
    port: 8095
    # -- ClusterIP for the Kubernetes proxy service.
    clusterIP: ""
  wireguard:
    # -- Annotations for the WireGuard service.
    annotations: {}
    # -- Additional labels for the WireGuard service.
    labels: {}
    # -- Service type for WireGuard (NodePort or LoadBalancer recommended).
    type: NodePort
    # -- Port for the WireGuard service.
    port: 50180
    # -- NodePort for the WireGuard service.
    nodePort: 30180
    # -- ClusterIP for the WireGuard service.
    clusterIP: ""
# Omni metrics configuration
metrics:
  # -- Deploy metrics service
  enabled: false
  service:
    # -- Metrics service type
    type: ClusterIP
    # -- Metrics service clusterIP. `None` makes a "headless service" (no virtual IP)
    clusterIP: ""
    # -- Metrics service annotations
    annotations: {}
    # -- Metrics service labels
    labels: {}
    # -- Metrics service port
    servicePort: 2122
  serviceMonitor:
    # -- Enable a prometheus ServiceMonitor
    enabled: false
    # -- Prometheus ServiceMonitor interval
    interval: 30s
    # -- Prometheus ServiceMonitor scrapeTimeout. If empty, Prometheus uses the global scrape timeout unless it is less than the target's scrape interval value in which the latter is used.
    scrapeTimeout: ""
    # -- When true, honorLabels preserves the metric's labels when they collide with the target's labels.
    honorLabels: false
    # -- Prometheus [RelabelConfigs] to apply to samples before scraping
    relabelings: []
    # -- Prometheus [MetricRelabelConfigs] to apply to samples before ingestion
    metricRelabelings: []
    # -- Prometheus ServiceMonitor scheme
    scheme: ""
    # -- Prometheus ServiceMonitor tlsConfig
    tlsConfig: {}
    # -- Prometheus ServiceMonitor namespace
    namespace: "" # "monitoring"
    # -- Prometheus ServiceMonitor selector
    selector: {}
    #prometheus: kube-prometheus
    # -- Prometheus ServiceMonitor labels
    labels: {}
    # -- Prometheus ServiceMonitor annotations
    annotations: {}
  rules:
    # -- Deploy a PrometheusRule for the application controller
    enabled: false
    # -- PrometheusRule namespace
    namespace: "" # "monitoring"
    # -- PrometheusRule selector
    selector: {}
    #prometheus: kube-prometheus
    # -- PrometheusRule labels
    labels: {}
    # -- PrometheusRule annotations
    annotations: {}
    # -- PrometheusRule.Spec for the application controller
    spec: []

# Service Account Configuration
serviceAccount:
  # -- Whether to create a ServiceAccount for Omni
  create: true
  # -- Automount API credentials for a ServiceAccount
  automount: false
  # -- Annotations for the ServiceAccount
  annotations: {}
  # -- Name of the ServiceAccount to use.
  # If not set and create is true, a name is generated using the fullname template.
  name: ""

# -- List of additional mounts to add (normally used with extraVolumes)
extraVolumeMounts: []

# -- List of extra volumes to add
extraVolumes: []

# -- Pod affinity settings for the Omni pod
affinity: {}

# -- Node selector to constrain which nodes the Omni pod is scheduled on
nodeSelector: {}

# -- Additional annotations to add to the Omni pod
podAnnotations: {}

# -- Additional labels to add to the Omni pod
podLabels: {}

# -- Use host networking for the Omni pod.
# This may be required in some environments (e.g., GKE with Container-Optimized OS)
# where the NET_ADMIN capability alone is not sufficient for creating the WireGuard interface.
# When enabled, dnsPolicy is automatically set to ClusterFirstWithHostNet (unless dnsPolicy is explicitly set).
hostNetwork: false

# -- DNS policy for the Omni pod.
# When not set and hostNetwork is enabled, defaults to ClusterFirstWithHostNet.
dnsPolicy: ""

# -- DNS configuration for the Omni pod.
dnsConfig: {}
#  nameservers:
#    - 1.1.1.1
#  searches:
#    - my-domain.local

# -- Priority class name for the Omni pod.
priorityClassName: ""

# -- Termination grace period in seconds for the Omni pod.
terminationGracePeriodSeconds: 30

# -- Init containers to add to the Omni pod.
initContainers: []
#  - name: wait-for-etcd
#    image: busybox:latest
#    command: ['sh', '-c', 'until nc -z etcd.etcd.svc.cluster.local 2379; do sleep 1; done']

# -- Extra containers (sidecars) to add to the Omni pod.
extraContainers: []

# -- Pod-level security context
podSecurityContext: {}

# -- Tolerations for the Omni pod
tolerations: []

# -- Extra Kubernetes objects to deploy with the helm chart
extraObjects: []
#- apiVersion: v1
#  kind: ConfigMap
#  metadata:
#    name: omni-example
#  data:
#    custom-setting: "true"
