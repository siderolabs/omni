suite: Config Secret Logic
templates:
  - secret-config.yaml

tests:
  # ========================================
  # Config Secret Creation Tests
  # ========================================
  - it: Should create Config Secret
    template: secret-config.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: RELEASE-NAME-omni-config

  - it: Should include config.yaml data
    template: secret-config.yaml
    asserts:
      - isNotNull:
          path: stringData["config.yaml"]

  - it: Should contain account configuration
    template: secret-config.yaml
    set:
      config:
        account:
          id: test-account-id
          name: test-account
    asserts:
      - matchRegex:
          path: stringData["config.yaml"]
          pattern: "test-account-id"

  - it: Should contain auth configuration
    template: secret-config.yaml
    set:
      config:
        auth:
          auth0:
            enabled: true
            domain: example.eu.auth0.com
    asserts:
      - matchRegex:
          path: stringData["config.yaml"]
          pattern: "example.eu.auth0.com"

  - it: Should include standard Helm labels
    template: secret-config.yaml
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: omni
      - equal:
          path: metadata.labels["app.kubernetes.io/instance"]
          value: RELEASE-NAME
      - isNotNull:
          path: metadata.labels["helm.sh/chart"]

  - it: Should be created in correct namespace
    template: secret-config.yaml
    release:
      namespace: custom-namespace
    asserts:
      - equal:
          path: metadata.namespace
          value: custom-namespace