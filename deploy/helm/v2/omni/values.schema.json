{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "additionalConfigSources": {
      "description": "Additional config sources to merge on top of the base config. These are merged in order: base config (from config: section) -\u003e additionalConfigSources (in order) -\u003e flags. This is useful for bringing in secrets from external sources (e.g., External Secrets Operator). Each source must contain a valid Omni config YAML that will be merged with the base config.",
      "type": "array"
    },
    "affinity": {
      "description": "Pod affinity settings for the Omni pod",
      "type": "object"
    },
    "args": {
      "description": "Extra arguments to pass to Omni.",
      "type": "array"
    },
    "config": {
      "type": "object",
      "properties": {
        "account": {
          "type": "object",
          "properties": {
            "id": {
              "description": "Unique identifier and name for this Omni instance. Must be a UUID and not changed during the lifetime of the installation.",
              "type": "string"
            },
            "name": {
              "description": "Name is the human-readable name of the account.",
              "type": "string"
            }
          }
        },
        "auth": {
          "type": "object",
          "properties": {
            "auth0": {
              "type": "object",
              "properties": {
                "clientID": {
                  "description": "ClientID is the Auth0 client ID.",
                  "type": "string"
                },
                "domain": {
                  "description": "Domain is the Auth0 domain.",
                  "type": "string"
                },
                "enabled": {
                  "description": "Enabled controls whether the Auth0 authentication provider is enabled.",
                  "type": "boolean"
                }
              }
            },
            "initialServiceAccount": {
              "description": "InitialServiceAccount contains configuration for the initial service account created when Omni is run for the first time.",
              "type": "null"
            },
            "initialUsers": {
              "description": "InitialUsers is a list of emails which should be created as admins when Omni is run for the first time.",
              "type": "array"
            },
            "keyPruner": {
              "description": "KeyPruner contains configuration for the public keys pruner.",
              "type": "null"
            },
            "oidc": {
              "description": "OIDC contains OIDC authentication provider configuration.",
              "type": "null"
            },
            "saml": {
              "description": "SAML contains SAML authentication provider configuration.",
              "type": "null"
            }
          }
        },
        "debug": {
          "type": "object",
          "properties": {
            "pprof": {
              "description": "Pprof contains pprof profiling configuration.",
              "type": "null"
            },
            "server": {
              "description": "Server contains debug server configuration.",
              "type": "null"
            }
          }
        },
        "etcdBackup": {
          "type": "object",
          "properties": {
            "localPath": {
              "description": "LocalPath is the local path where etcd backups are stored. Path-based backups are enabled when this is set. This path is mounted from the persistent volume by default.",
              "type": "string"
            },
            "s3Enabled": {
              "description": "S3Enabled controls whether an S3-compatible storage is used for etcd backups. Mutually exclusive with localPath.",
              "type": "boolean"
            }
          }
        },
        "features": {
          "description": "Features contains feature flags to enable/disable various Omni features.",
          "type": "null"
        },
        "logs": {
          "type": "object",
          "properties": {
            "audit": {
              "description": "Audit contains audit logs configuration.",
              "type": "null"
            },
            "machine": {
              "type": "object",
              "properties": {
                "storage": {
                  "description": "Storage contains configuration for machine logs storage.",
                  "type": "null"
                }
              }
            },
            "resourceLogger": {
              "description": "ResourceLogger contains resource logger configuration.",
              "type": "null"
            }
          }
        },
        "registries": {
          "description": "Registries contains container image registries configuration.",
          "type": "null"
        },
        "services": {
          "type": "object",
          "properties": {
            "api": {
              "type": "object",
              "properties": {
                "advertisedURL": {
                  "description": "The advertised URL for the main Omni GRPC and HTTP API and Web UI. MUST be specified as a full URL, including scheme (http:// or https://). It MUST match the URL of the main ingress if ingress is used.",
                  "type": "string"
                }
              }
            },
            "embeddedDiscoveryService": {
              "description": "EmbeddedDiscoveryService contains embedded discovery service configuration.",
              "type": "null"
            },
            "kubernetesProxy": {
              "type": "object",
              "properties": {
                "advertisedURL": {
                  "description": "The advertised URL for the Kubernetes API Proxy. MUST be specified as a full URL, including scheme (https://). It MUST match the URL of the kubernetes proxy ingress if ingress is used.",
                  "type": "string"
                }
              }
            },
            "loadBalancer": {
              "description": "LoadBalancer contains load balancer service configuration.",
              "type": "null"
            },
            "localResourceService": {
              "description": "LocalResourceService contains local resource service configuration.",
              "type": "null"
            },
            "machineAPI": {
              "type": "object",
              "properties": {
                "advertisedURL": {
                  "description": "The advertised URL for the SideroLink (Machine) API. MUST be specified as a full URL, including scheme (http:// or https://). It MUST match the URL of the siderolink API ingress if ingress is used.",
                  "type": "string"
                }
              }
            },
            "siderolink": {
              "type": "object",
              "properties": {
                "eventSinkPort": {
                  "description": "EventSinkPort is the port to be used by the nodes to publish their events over SideroLink to Omni.",
                  "type": "integer"
                },
                "joinTokensMode": {
                  "description": "JoinTokensMode configures how machine join tokens are generated and used.",
                  "type": "string"
                },
                "wireGuard": {
                  "type": "object",
                  "properties": {
                    "advertisedEndpoint": {
                      "description": "The advertised address for WireGuard connections. MUST be specified in IP:PORT format (hostname is NOT supported, must be an IP address). In most setups, this is either: - NodePort: Use the externally accessible IP of a node and service.wireguard.nodePort (e.g., \"203.0.113.10:30180\") - LoadBalancer: Use the LoadBalancer's external IP and service.wireguard.port (e.g., \"203.0.113.50:50180\")",
                      "type": "string"
                    }
                  }
                }
              }
            },
            "workloadProxy": {
              "type": "object",
              "properties": {
                "enabled": {
                  "description": "Enabled controls whether the workload proxy service is enabled. In on-prem setups, it is often disabled.",
                  "type": "boolean"
                },
                "subdomain": {
                  "description": "Subdomain is the subdomain used by the workload proxy service to expose workloads.",
                  "type": "string"
                }
              }
            }
          }
        },
        "storage": {
          "type": "object",
          "properties": {
            "default": {
              "type": "object",
              "properties": {
                "boltdb": {
                  "type": "object",
                  "properties": {
                    "path": {
                      "description": "Path to the primary BoltDB database. Is **NOT USED by default**: only used if the storage.default.kind is set to \"boltdb\". This path is mounted from the persistent volume by default.",
                      "type": "string"
                    }
                  }
                },
                "etcd": {
                  "type": "object",
                  "properties": {
                    "embedded": {
                      "description": "Embedded controls whether to use embedded etcd server as the storage backend.",
                      "type": "boolean"
                    },
                    "embeddedDBPath": {
                      "description": "EmbeddedDBPath is the path where the embedded etcd database files are stored. This path is mounted from the persistent volume by default.",
                      "type": "string"
                    },
                    "privateKeySource": {
                      "description": "PrivateKeySource is the source of the private key for decrypting master key slot.",
                      "type": "string"
                    }
                  }
                },
                "kind": {
                  "description": "Kind is the kind of the default storage backend (etcd or boltdb).",
                  "type": "string"
                }
              }
            },
            "sqlite": {
              "type": "object",
              "properties": {
                "path": {
                  "description": "Path to the SQLite database (secondary storage). This path is mounted from the persistent volume by default.",
                  "type": "string"
                }
              }
            },
            "vault": {
              "type": "object",
              "properties": {
                "token": {
                  "description": "Token is the authentication token for the Vault server. Tip: Use additionalConfigSources to load this from an existing Secret, or set the VAULT_TOKEN environment variable via env/envFrom.",
                  "type": "string"
                },
                "url": {
                  "description": "Url is the URL of the Vault server.",
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "env": {
      "description": "Environment variables to pass to Omni.",
      "type": "array"
    },
    "envFrom": {
      "description": "envFrom to pass to Omni.",
      "type": "array"
    },
    "etcdEncryptionKey": {
      "type": "object",
      "properties": {
        "existingSecret": {
          "description": "Name of an existing Secret containing the GPG private key.",
          "type": "string"
        },
        "omniAsc": {
          "description": "GPG private key content (multiline string).",
          "type": "string"
        }
      }
    },
    "extraObjects": {
      "description": "Extra Kubernetes objects to deploy with the helm chart",
      "type": "array"
    },
    "extraVolumeMounts": {
      "description": "List of additional mounts to add (normally used with extraVolumes)",
      "type": "array"
    },
    "extraVolumes": {
      "description": "List of extra volumes to add",
      "type": "array"
    },
    "fullnameOverride": {
      "description": "String to fully override `\"omni.fullname\"`.",
      "type": "string"
    },
    "gatewayApi": {
      "type": "object",
      "properties": {
        "grpc": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Additional Annotations",
              "type": "object"
            },
            "enabled": {
              "description": "Enable GRPCRoute for gRPC API.",
              "type": "boolean"
            },
            "hostnames": {
              "description": "Omni GRPC hostname",
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "labels": {
              "description": "Additional Labels",
              "type": "object"
            },
            "parentRefs": {
              "description": "The Gateway(s) to attach this route to. You MUST define at least one parentRef for the route to be active.",
              "type": "array"
            }
          }
        },
        "kubernetesProxy": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Additional Annotations",
              "type": "object"
            },
            "enabled": {
              "description": "Enable HTTPRoute for Kubernetes Proxy.",
              "type": "boolean"
            },
            "hostnames": {
              "description": "Omni Kubernetes Proxy hostname",
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "labels": {
              "description": "Additional Labels",
              "type": "object"
            },
            "parentRefs": {
              "description": "The Gateway(s) to attach this route to. You MUST define at least one parentRef for the route to be active.",
              "type": "array"
            }
          }
        },
        "siderolinkApi": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Additional Annotations",
              "type": "object"
            },
            "enabled": {
              "description": "Enable GRPCRoute for SideroLink Machine API.",
              "type": "boolean"
            },
            "hostnames": {
              "description": "Omni SideroLink Machine API hostname",
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "labels": {
              "description": "Additional Labels",
              "type": "object"
            },
            "parentRefs": {
              "description": "The Gateway(s) to attach this route to. You MUST define at least one parentRef for the route to be active.",
              "type": "array"
            }
          }
        },
        "ui": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Additional Annotations",
              "type": "object"
            },
            "enabled": {
              "description": "Enable HTTPRoute for Web UI.",
              "type": "boolean"
            },
            "hostnames": {
              "description": "Omni UI hostname",
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "labels": {
              "description": "Additional Labels",
              "type": "object"
            },
            "parentRefs": {
              "description": "The Gateway(s) to attach this route to. You MUST define at least one parentRef for the route to be active.",
              "type": "array"
            }
          }
        }
      }
    },
    "image": {
      "type": "object",
      "properties": {
        "pullPolicy": {
          "description": "Image pull policy for Omni.",
          "type": "string"
        },
        "repository": {
          "description": "Repository to use for Omni.",
          "type": "string"
        },
        "tag": {
          "description": "Tag to use for Omni.",
          "type": "string"
        }
      }
    },
    "imagePullSecrets": {
      "description": "Secrets with credentials to pull images from a private registry.",
      "type": "array"
    },
    "ingress": {
      "type": "object",
      "properties": {
        "grpc": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Additional Annotations Example annotations for NGINX Ingress: nginx.ingress.kubernetes.io/backend-protocol: GRPC nginx.ingress.kubernetes.io/proxy-body-size: 32m nginx.ingress.kubernetes.io/service-upstream: \"true\"",
              "type": "object"
            },
            "className": {
              "description": "Ingress Class Name",
              "type": "string"
            },
            "enabled": {
              "description": "Enable ingress for gRPC API.",
              "type": "boolean"
            },
            "host": {
              "description": "Omni GRPC hostname",
              "type": "string"
            },
            "labels": {
              "description": "Additional Labels",
              "type": "object"
            },
            "skipConfigCheck": {
              "description": "Set to true to skip validation between this Ingress and config.services.api.advertisedURL",
              "type": "boolean"
            },
            "tls": {
              "description": "TLS configuration",
              "type": "array"
            }
          }
        },
        "kubernetesProxy": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Additional Annotations",
              "type": "object"
            },
            "className": {
              "description": "Ingress Class Name",
              "type": "string"
            },
            "enabled": {
              "description": "Enable ingress for Kubernetes Proxy.",
              "type": "boolean"
            },
            "host": {
              "description": "Omni Kubernetes Proxy hostname",
              "type": "string"
            },
            "labels": {
              "description": "Additional Labels",
              "type": "object"
            },
            "skipConfigCheck": {
              "description": "Set to true to skip validation between this Ingress and config.services.kubernetesProxy.advertisedURL",
              "type": "boolean"
            },
            "tls": {
              "description": "TLS configuration",
              "type": "array"
            }
          }
        },
        "main": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Additional Annotations",
              "type": "object"
            },
            "className": {
              "description": "Ingress Class Name",
              "type": "string"
            },
            "enabled": {
              "description": "Enable ingress for Web UI.",
              "type": "boolean"
            },
            "host": {
              "description": "Omni UI hostname",
              "type": "string"
            },
            "labels": {
              "description": "Additional Labels",
              "type": "object"
            },
            "skipConfigCheck": {
              "description": "Set to true to skip validation between this Ingress and config.services.api.advertisedURL",
              "type": "boolean"
            },
            "tls": {
              "description": "TLS configuration",
              "type": "array"
            }
          }
        },
        "siderolinkApi": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Additional Annotations Example annotations for NGINX Ingress: nginx.ingress.kubernetes.io/backend-protocol: GRPC nginx.ingress.kubernetes.io/proxy-body-size: 100m",
              "type": "object"
            },
            "className": {
              "description": "Ingress Class Name",
              "type": "string"
            },
            "enabled": {
              "description": "Enable ingress for SideroLink Machine API.",
              "type": "boolean"
            },
            "host": {
              "description": "Omni SideroLink Machine API hostname",
              "type": "string"
            },
            "labels": {
              "description": "Additional Labels",
              "type": "object"
            },
            "skipConfigCheck": {
              "description": "Set to true to skip validation between this Ingress and config.services.machineAPI.advertisedURL",
              "type": "boolean"
            },
            "tls": {
              "description": "TLS configuration",
              "type": "array"
            }
          }
        }
      }
    },
    "livenessProbe": {
      "description": "Liveness probe configuration.",
      "type": "object"
    },
    "metrics": {
      "type": "object",
      "properties": {
        "enabled": {
          "description": "Deploy metrics service",
          "type": "boolean"
        },
        "rules": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "PrometheusRule annotations",
              "type": "object"
            },
            "enabled": {
              "description": "Deploy a PrometheusRule for the application controller",
              "type": "boolean"
            },
            "labels": {
              "description": "PrometheusRule labels",
              "type": "object"
            },
            "namespace": {
              "description": "PrometheusRule namespace",
              "type": "string"
            },
            "selector": {
              "description": "PrometheusRule selector",
              "type": "object"
            },
            "spec": {
              "description": "PrometheusRule.Spec for the application controller",
              "type": "array"
            }
          }
        },
        "service": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Metrics service annotations",
              "type": "object"
            },
            "clusterIP": {
              "description": "Metrics service clusterIP. `None` makes a \"headless service\" (no virtual IP)",
              "type": "string"
            },
            "labels": {
              "description": "Metrics service labels",
              "type": "object"
            },
            "servicePort": {
              "description": "Metrics service port",
              "type": "integer"
            },
            "type": {
              "description": "Metrics service type",
              "type": "string"
            }
          }
        },
        "serviceMonitor": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Prometheus ServiceMonitor annotations",
              "type": "object"
            },
            "enabled": {
              "description": "Enable a prometheus ServiceMonitor",
              "type": "boolean"
            },
            "honorLabels": {
              "description": "When true, honorLabels preserves the metric's labels when they collide with the target's labels.",
              "type": "boolean"
            },
            "interval": {
              "description": "Prometheus ServiceMonitor interval",
              "type": "string"
            },
            "labels": {
              "description": "Prometheus ServiceMonitor labels",
              "type": "object"
            },
            "metricRelabelings": {
              "description": "Prometheus [MetricRelabelConfigs] to apply to samples before ingestion",
              "type": "array"
            },
            "namespace": {
              "description": "Prometheus ServiceMonitor namespace",
              "type": "string"
            },
            "relabelings": {
              "description": "Prometheus [RelabelConfigs] to apply to samples before scraping",
              "type": "array"
            },
            "scheme": {
              "description": "Prometheus ServiceMonitor scheme",
              "type": "string"
            },
            "scrapeTimeout": {
              "description": "Prometheus ServiceMonitor scrapeTimeout. If empty, Prometheus uses the global scrape timeout unless it is less than the target's scrape interval value in which the latter is used.",
              "type": "string"
            },
            "selector": {
              "description": "Prometheus ServiceMonitor selector",
              "type": "object"
            },
            "tlsConfig": {
              "description": "Prometheus ServiceMonitor tlsConfig",
              "type": "object"
            }
          }
        }
      }
    },
    "nameOverride": {
      "description": "Provide a name in place of `\"omni\"`.",
      "type": "string"
    },
    "namespaceOverride": {
      "description": "String to fully override `\"omni.namespace\"`.",
      "type": "string"
    },
    "nodeSelector": {
      "description": "Node selector to constrain which nodes the Omni pod is scheduled on",
      "type": "object"
    },
    "persistence": {
      "type": "object",
      "properties": {
        "accessModes": {
          "description": "Access modes for the PVC. 'ReadWriteOnce' is recommended as Omni does not support multiple active replicas writing to the same file-based DB.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "annotations": {
          "description": "Annotations",
          "type": "object"
        },
        "enabled": {
          "description": "Enable persistence. Mounts to `/data` inside the container.",
          "type": "boolean"
        },
        "existingClaim": {
          "description": "Name of an existing PersistentVolumeClaim to use. If set, a new PVC will NOT be created.",
          "type": "string"
        },
        "size": {
          "description": "Size of the persistent volume. Recommended: 16Gi+ for production to handle etcd snapshots and logs.",
          "type": "string"
        },
        "storageClassName": {
          "description": "Storage Class to use for the PVC. Leave empty to use the cluster's default storage class.",
          "type": "string"
        }
      }
    },
    "podAnnotations": {
      "description": "Additional annotations to add to the Omni pod",
      "type": "object"
    },
    "podLabels": {
      "description": "Additional labels to add to the Omni pod",
      "type": "object"
    },
    "podSecurityContext": {
      "description": "Pod-level security context",
      "type": "object"
    },
    "readinessProbe": {
      "description": "Readiness probe configuration.",
      "type": "object",
      "properties": {
        "failureThreshold": {
          "type": "integer"
        },
        "httpGet": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string"
            },
            "port": {
              "type": "string"
            },
            "scheme": {
              "type": "string"
            }
          }
        },
        "periodSeconds": {
          "type": "integer"
        },
        "successThreshold": {
          "type": "integer"
        },
        "timeoutSeconds": {
          "type": "integer"
        }
      }
    },
    "replicaCount": {
      "description": "Number of replicas to run. Omni currently only supports a single replica. If embedded etcd is used, this value should remain at 1. If an external etcd cluster is used, multiple replicas can be used, but they will run an etcd election and only one instance will be active at a time, others will be standby.",
      "type": "integer"
    },
    "resources": {
      "description": "CPU and Memory resource requests and limits.",
      "type": "object"
    },
    "securityContext": {
      "description": "Pod Security Context Omni container-level security context",
      "type": "object",
      "properties": {
        "allowPrivilegeEscalation": {
          "type": "boolean"
        },
        "capabilities": {
          "type": "object",
          "properties": {
            "add": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "drop": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "service": {
      "type": "object",
      "properties": {
        "grpc": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Annotations for the gRPC service.",
              "type": "object"
            },
            "clusterIP": {
              "description": "ClusterIP for the gRPC service.",
              "type": "string"
            },
            "omniPort": {
              "description": "Port for the Omni gRPC API.",
              "type": "integer"
            },
            "siderolinkApiPort": {
              "description": "Port for the SideroLink API.",
              "type": "integer"
            },
            "type": {
              "description": "Service type for the gRPC service.",
              "type": "string"
            }
          }
        },
        "main": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Annotations for the main service.",
              "type": "object"
            },
            "clusterIP": {
              "description": "ClusterIP for the main service.",
              "type": "string"
            },
            "k8sProxyPort": {
              "description": "Port for the Kubernetes proxy.",
              "type": "integer"
            },
            "omniPort": {
              "description": "Port for the Omni HTTP API and UI.",
              "type": "integer"
            },
            "type": {
              "description": "Service type for the main service.",
              "type": "string"
            }
          }
        },
        "wireguard": {
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Annotations for the WireGuard service.",
              "type": "object"
            },
            "clusterIP": {
              "description": "ClusterIP for the WireGuard service.",
              "type": "string"
            },
            "nodePort": {
              "description": "NodePort for the WireGuard service.",
              "type": "integer"
            },
            "port": {
              "description": "Port for the WireGuard service.",
              "type": "integer"
            },
            "type": {
              "description": "Service type for WireGuard (NodePort or LoadBalancer recommended).",
              "type": "string"
            }
          }
        }
      }
    },
    "serviceAccount": {
      "type": "object",
      "properties": {
        "annotations": {
          "description": "Annotations for the ServiceAccount",
          "type": "object"
        },
        "automount": {
          "description": "Automount API credentials for a ServiceAccount",
          "type": "boolean"
        },
        "create": {
          "description": "Whether to create a ServiceAccount for Omni",
          "type": "boolean"
        },
        "name": {
          "description": "Name of the ServiceAccount to use. If not set and create is true, a name is generated using the fullname template.",
          "type": "string"
        }
      }
    },
    "skipVersionCheck": {
      "description": "Set to true to bypass the SemVer check (e.g. if using a custom build or nightly tag).",
      "type": "boolean"
    },
    "strategy": {
      "type": "object",
      "properties": {
        "type": {
          "description": "Deployment strategy type.",
          "type": "string"
        }
      }
    },
    "tolerations": {
      "description": "Tolerations for the Omni pod",
      "type": "array"
    }
  }
}
