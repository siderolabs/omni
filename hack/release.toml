# commit to be tagged for the new release
commit = "HEAD"

project_name = "Omni"
github_repo = "siderolabs/omni"
match_deps = "^github.com/((talos-systems|siderolabs)/[a-zA-Z0-9-]+)$"

pre_release = true
previous = "v1.3.0"

[notes.aaa-urgent-sqlite-migration]
title = "Urgent Upgrade Notes **(No, really, you MUST read this before you upgrade)**"
description = """\
This release consolidates **Discovery service state**, **Audit logs**, **Machine logs**, and **Secondary resources** into a single SQLite storage backend.

**1. New Required Flag**
You **must** set the new `--sqlite-storage-path` (or `.storage.sqlite.path`) flag. There is no default value, and Omni will not start without it.

**2. Audit Logging Changes**
A new flag `--audit-log-enabled` (or `.logs.audit.enabled`) has been introduced to explicitly enable or disable audit logging.
* **Default:** `true`.
* **Change:** Previously, audit logging was implicitly enabled only when the path was set. Now, it is enabled by default.

**3. Automatic Migration**
Omni will automatically migrate your existing data (BoltDB, file-based logs) to the new SQLite database on the first startup. To ensure this happens correctly, simply add the new SQLite flag and **leave your existing storage flags in place** for the first run.

Once the migration is complete, you are free to remove the deprecated flags listed below. If they remain, they will be ignored and eventually dropped in future versions.

**4. Deprecated Flags (Kept for Migration)**
The following flags (and config keys) are deprecated and kept solely to facilitate the automatic migration:
* `--audit-log-dir` (`.logs.audit.path`)
* `--secondary-storage-path` (`.storage.secondary.path`)
* `--machine-log-storage-path` (`.logs.machine.storage.path`)
* `--machine-log-storage-enabled` (`.logs.machine.storage.enabled`)
* `--embedded-discovery-service-snapshot-path` (`.services.embeddedDiscoveryService.snapshotsPath`)
* `--machine-log-buffer-capacity` (`.logs.machine.bufferInitialCapacity`)
* `--machine-log-buffer-max-capacity` (`.logs.machine.bufferMaxCapacity`)
* `--machine-log-buffer-safe-gap` (`.logs.machine.bufferSafetyGap`)
* `--machine-log-num-compressed-chunks` (`.logs.machine.storage.numCompressedChunks`)

**5. Removed Flags**
The following flags have been removed and are no longer supported:
* `--machine-log-storage-flush-period` (`.logs.machine.storage.flushPeriod`)
* `--machine-log-storage-flush-jitter` (`.logs.machine.storage.flushJitter`)
"""

[notes.infra-provider-cleanup]
title = "Force Deletion of Infra Provider Resources"
description = """\
Added the ability to force-delete `MachineRequests` and `InfraMachines` managed by Infra providers.
This allows for the cleanup of resources and finalizers even if the underlying provider is unresponsive or deleted.
"""

[notes.auth-saml-dynamic-roles]
title = "Dynamic SAML Label Role Updates"
description = """\
Added support for dynamically updating SAML label roles on every login via the new `update_on_each_login` field.
"""

[notes.auth-extend-oidc-support]
title = "Support for OIDC Providers without Email Verified Claim"
description = """\
Enabled support for OIDC providers, such as Azure, that do not provide the `email_verified` claim during authentication.
"""

[notes.backend-platform-info]
title = "Virtual Resources for Platform Information"
description = """\
Platform and SBC information is now pulled from Talos machinery and presented as virtual resources:
`MetalPlatformConfig`, `CloudPlatformConfig`, and `SBCConfig`. They support `Get` and `List` operations.
"""

[notes.backend-machine-classes-logic]
title = "Machine Class Logic Updates"
description = """\
Added support for locks, node deletion, and restore operations when using machine classes.
"""

[notes.talos-version-downgrade-prevention]
title = "Prevent Talos Minor Version Downgrades"
description = """\
Omni now prevents downgrading the Talos minor version below the initial version used to create the cluster.
This safeguard prevents machine configurations from entering a broken state due to unsupported features in older versions.
"""

[notes.frontend-oidc-warning]
title = "OIDC Warning for Kubeconfig Download"
description = """\
A warning toast is now displayed when downloading kubeconfig to inform users that the OIDC plugin is required before using the file with kubectl.
"""

[notes.frontend-cli-install-options]
title = "Automated CLI Install Options"
description = """\
Automated installation options have been added to the CLI section of the homepage, supplementing the existing manual options.
"""

[notes.frontend-ui-improvements]
title = "UI/UX Improvements"
description = """\
Various UI improvements including pre-selecting the correct binary for the user's platform, truncating long items in the ongoing tasks list,
hiding JSON schema descriptions behind tooltips, and standardizing link styling.
"""
