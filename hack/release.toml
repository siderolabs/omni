# commit to be tagged for the new release
commit = "HEAD"

project_name = "Omni"
github_repo = "siderolabs/omni"
match_deps = "^github.com/((talos-systems|siderolabs)/[a-zA-Z0-9-]+)$"

pre_release = false
previous = "v1.4.8"

[notes]

[notes.aaa-urgent-sqlite-migration]
title = "Urgent Upgrade Notes **(No, really, you MUST read this before you upgrade)**"
description = """\
This release consolidates **Discovery service state**, **Audit logs**, **Machine logs**, and **Secondary resources** into a single SQLite storage backend.

**1. New Required Flag**
You **must** set the new `--sqlite-storage-path` (or `.storage.sqlite.path`) flag. There is no default value, and Omni will not start without it.
It **must** be a path to the SQLite file (will be created by Omni), **not** a directory, e.g., `--sqlite-storage-path=/path/to/omni-sqlite.db`.

**2. Audit Logging Changes**
A new flag `--audit-log-enabled` (or `.logs.audit.enabled`) has been introduced to explicitly enable or disable audit logging.
* **Default:** `true`.
* **Change:** Previously, audit logging was implicitly enabled only when the path was set. Now, it is enabled by default.

**3. Automatic Migration**
Omni will automatically migrate your existing data (BoltDB, file-based logs) to the new SQLite database on the first startup. To ensure this happens correctly, simply add the new SQLite flag and **leave your existing storage flags in place** for the first run.

Once the migration is complete, you are free to remove the deprecated flags listed below. If they remain, they will be ignored and eventually dropped in future versions.

**4. Deprecated Flags (Kept for Migration)**
The following flags (and config keys) are deprecated and kept solely to facilitate the automatic migration:
* `--audit-log-dir` (`.logs.audit.path`)
* `--secondary-storage-path` (`.storage.secondary.path`)
* `--machine-log-storage-path` (`.logs.machine.storage.path`)
* `--machine-log-storage-enabled` (`.logs.machine.storage.enabled`)
* `--embedded-discovery-service-snapshot-path` (`.services.embeddedDiscoveryService.snapshotsPath`)
* `--machine-log-buffer-capacity` (`.logs.machine.bufferInitialCapacity`)
* `--machine-log-buffer-max-capacity` (`.logs.machine.bufferMaxCapacity`)
* `--machine-log-buffer-safe-gap` (`.logs.machine.bufferSafetyGap`)
* `--machine-log-num-compressed-chunks` (`.logs.machine.storage.numCompressedChunks`)

**5. Removed Flags**
The following flags have been removed and are no longer supported:
* `--machine-log-storage-flush-period` (`.logs.machine.storage.flushPeriod`)
* `--machine-log-storage-flush-jitter` (`.logs.machine.storage.flushJitter`)
"""
